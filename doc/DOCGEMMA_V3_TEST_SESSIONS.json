{
  "_metadata": {
    "version": "3.0",
    "description": "DocGemma v3 Agent Graph test sessions. All 40 original sessions annotated with per-turn expected node behavior, plus 6 new error/edge-case sessions and 40 node-level unit tests.",
    "architecture": "INPUT_ASSEMBLY → INTENT_CLASSIFY → [DIRECT: SYNTHESIZE] | [TOOL_NEEDED: TOOL_SELECT → TOOL_EXECUTE → RESULT_CLASSIFY → DETERMINISTIC_ROUTER → loop or SYNTHESIZE]",
    "date": "2026-02-11",
    "annotation_schema": {
      "expected_intent": "DIRECT | TOOL_NEEDED — output of INTENT_CLASSIFY",
      "expected_tool": "Tool name or null for DIRECT — output of TOOL_SELECT Stage 1",
      "expected_args": "Key arguments that must be extracted — output of TOOL_SELECT Stage 2",
      "expected_path": "Shorthand for the node traversal sequence",
      "expected_result_classification": "What RESULT_CLASSIFY should output given a successful mock tool result",
      "expected_entities": "What INPUT_ASSEMBLY should extract via regex/dictionary",
      "notes": "Implementation-relevant notes for this specific turn"
    },
    "path_shorthands": {
      "DIRECT": "INPUT_ASSEMBLY → INTENT_CLASSIFY → SYNTHESIZE",
      "IMAGE_DIRECT": "INPUT_ASSEMBLY(vision) → INTENT_CLASSIFY → SYNTHESIZE",
      "SINGLE_TOOL": "INPUT_ASSEMBLY → INTENT_CLASSIFY → TOOL_SELECT → TOOL_EXECUTE → RESULT_CLASSIFY → ROUTER → SYNTHESIZE",
      "IMAGE_SINGLE_TOOL": "INPUT_ASSEMBLY(vision) → INTENT_CLASSIFY → TOOL_SELECT → TOOL_EXECUTE → RESULT_CLASSIFY → ROUTER → SYNTHESIZE",
      "MULTI_TOOL_2": "... → [TOOL_SELECT → EXECUTE → CLASSIFY → ROUTER] x2 → SYNTHESIZE",
      "MULTI_TOOL_3": "... → [TOOL_SELECT → EXECUTE → CLASSIFY → ROUTER] x3 → SYNTHESIZE",
      "ERROR_RETRY": "... → RESULT_CLASSIFY(error) → ROUTER → ERROR_HANDLER(retry) → TOOL_SELECT → ...",
      "ERROR_SKIP": "... → RESULT_CLASSIFY(error) → ROUTER → ERROR_HANDLER(skip) → SYNTHESIZE",
      "ERROR_ASK_USER": "... → RESULT_CLASSIFY(error) → ROUTER → ERROR_HANDLER(ask_user) → SYNTHESIZE"
    }
  },

  "sessions": [
    {
      "session_id": "session_01_internal_medicine_rounds",
      "description": "Hospitalist morning rounds - sequential patient workup",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "Good morning DocGemma",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Greeting. No tools. Cold start — no prior context."
        },
        {
          "user_input": "Can you find patient Margaret Chen in the system?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_patient",
          "expected_args": { "name": "Margaret Chen" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] },
          "notes": "Multi-turn turn 2 — prior greeting provides context. Model should NOT select get_patient_chart (no ID yet)."
        },
        {
          "user_input": "Pull up her chart",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "get_patient_chart",
          "expected_args": { "patient_id": "<from_previous_search_result>" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Requires multi-turn context. patient_id must come from prior search_patient result in conversation history. Tests pronoun resolution ('her')."
        },
        {
          "user_input": "She's on metformin 1000mg BID. What are the current FDA boxed warnings?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "metformin" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin"], "action_verbs": [] },
          "notes": "Drug extracted by INPUT_ASSEMBLY regex. Key confusion test: 'She's on' with patient context must NOT trigger get_patient_chart. Section 23 confusion: 'for my patient' pattern."
        },
        {
          "user_input": "She's also on lisinopril and spironolactone. Any interaction concerns?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["lisinopril", "spironolactone"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["lisinopril", "spironolactone"], "action_verbs": [] },
          "notes": "Two drugs extracted by INPUT_ASSEMBLY. Tests multi-drug arg extraction."
        },
        {
          "user_input": "Her latest GFR is 38. Given her CKD stage 3b, should I continue metformin at this dose or adjust?",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin"], "action_verbs": [] },
          "notes": "Clinical reasoning question. No tool needed — this is a knowledge question about dose adjustment that SYNTHESIZE handles with task_summary context. The prior chart data is in conversation history."
        },
        {
          "user_input": "Alright, prescribe empagliflozin 10mg daily for her",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "prescribe_medication",
          "expected_args": { "patient_id": "<from_prior_context>", "medication_name": "empagliflozin", "dosage": "10mg", "frequency": "daily" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["empagliflozin"], "action_verbs": ["prescribe"] },
          "notes": "Write operation. patient_id must resolve from conversation history. All 4 required prescription args must be extracted."
        },
        {
          "user_input": "Save a note: Transitioning from metformin 1000mg BID to empagliflozin 10mg daily due to declining renal function. GFR 38. Will monitor renal function and ketone levels at 2-week follow-up.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "save_clinical_note",
          "expected_args": { "patient_id": "<from_prior_context>", "note_type": "progress-note", "note_text": "Transitioning from metformin 1000mg BID to empagliflozin 10mg daily due to declining renal function. GFR 38. Will monitor renal function and ketone levels at 2-week follow-up." },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin", "empagliflozin"], "action_verbs": ["save"] },
          "notes": "Write operation. Section 23 confusion risk: 'patient' in note text must NOT trigger get_patient_chart. note_text should preserve user's text, not paraphrase."
        }
      ]
    },

    {
      "session_id": "session_02_ed_pulmonology",
      "description": "Emergency physician evaluating febrile dyspneic patient with chest imaging",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "58M presents with productive cough, fever 39.2, dyspnea on exertion x3 days. SpO2 91% on RA. Here's his CXR.",
          "image_base64": "PLACEHOLDER_BASE64_CHEST_XRAY_PA_58M_RIGHT_LOWER_LOBE_CONSOLIDATION",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "IMAGE_DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true },
          "notes": "Image present — INPUT_ASSEMBLY runs vision analysis. No explicit tool request, just presenting a case with image. SYNTHESIZE uses image_findings + clinical context."
        },
        {
          "user_input": "Can you comment on the costophrenic angles? I'm worried about a parapneumonic effusion.",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Follow-up on prior image. Image findings already in conversation history from turn 1. This is a clinical reasoning question about the prior image, not a new tool call."
        },
        {
          "user_input": "I'm considering piperacillin-tazobactam. Check the safety profile for me.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "piperacillin-tazobactam" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["piperacillin-tazobactam"], "action_verbs": ["check"] },
          "notes": "Compound drug name — tests INPUT_ASSEMBLY drug dictionary matching for combination drugs."
        },
        {
          "user_input": "He's on warfarin for a mechanical mitral valve. Any interactions with pip-tazo?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["warfarin", "piperacillin-tazobactam"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["warfarin"], "action_verbs": [] },
          "notes": "Abbreviation 'pip-tazo' must resolve to piperacillin-tazobactam from conversation context. Tests abbreviation handling."
        },
        {
          "user_input": "Search the literature on empiric antibiotic regimens for hospital-acquired pneumonia in patients on anticoagulation",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_medical_literature",
          "expected_args": { "query": "empiric antibiotic regimens hospital-acquired pneumonia anticoagulation" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] },
          "notes": "Explicit literature search request. Query should capture the clinical specificity."
        }
      ]
    },

    {
      "session_id": "session_03_oncology_tumor_board",
      "description": "Oncologist preparing for tumor board with CT imaging and treatment planning",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "67F with 4-month history of epigastric pain, 8kg weight loss, CA 19-9 elevated at 842 U/mL. Review this abdominal CT with contrast.",
          "image_base64": "PLACEHOLDER_BASE64_CT_ABDOMEN_CONTRAST_67F_PANCREATIC_HEAD_MASS_BILE_DUCT_DILATION",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "IMAGE_DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true },
          "notes": "Image analysis with clinical context. No tool call — image findings from INPUT_ASSEMBLY vision + clinical reasoning from SYNTHESIZE."
        },
        {
          "user_input": "Based on what you see, what's the likely T and N staging? The mass appears to abut the SMA but I'm not sure about encasement vs abutment.",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Follow-up on prior image analysis. Clinical reasoning question."
        },
        {
          "user_input": "Find active clinical trials for borderline resectable pancreatic adenocarcinoma",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "find_clinical_trials",
          "expected_args": { "condition": "borderline resectable pancreatic adenocarcinoma" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] },
          "notes": "Section 23 confusion risk: 'clinical trials' must NOT route to search_medical_literature. 56% confusion rate on this pair."
        },
        {
          "user_input": "What are the boxed warnings on oxaliplatin? She has pre-existing peripheral neuropathy grade 1.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "oxaliplatin" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["oxaliplatin"], "action_verbs": [] },
          "notes": "Drug safety lookup. The neuropathy context is for SYNTHESIZE to incorporate, not for tool selection."
        },
        {
          "user_input": "Check interactions between oxaliplatin, irinotecan, fluorouracil, and leucovorin",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["oxaliplatin", "irinotecan", "fluorouracil", "leucovorin"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["oxaliplatin", "irinotecan", "fluorouracil", "leucovorin"], "action_verbs": ["check"] },
          "notes": "4-drug interaction check. Tests extraction of multiple drug names."
        },
        {
          "user_input": "Search recent literature comparing FOLFIRINOX vs gemcitabine plus nab-paclitaxel in borderline resectable pancreatic cancer",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_medical_literature",
          "expected_args": { "query": "FOLFIRINOX vs gemcitabine nab-paclitaxel borderline resectable pancreatic cancer" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["gemcitabine"], "action_verbs": ["search"] },
          "notes": "Literature search. FOLFIRINOX is a regimen name, not a single drug."
        }
      ]
    },

    {
      "session_id": "session_04_dermatopathology",
      "description": "Dermatologist reviewing biopsy histopathology and literature",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "45M, punch biopsy from a pigmented lesion on the left forearm. Lesion was 7mm, irregular borders, recent change in color per patient. Here's the H&E slide.",
          "image_base64": "PLACEHOLDER_BASE64_HISTOPATHOLOGY_HE_SKIN_PUNCH_BIOPSY_SPITZOID_MELANOCYTIC_PROLIFERATION",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "IMAGE_DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true },
          "notes": "Histopathology image analysis."
        },
        {
          "user_input": "Is that consistent with a Spitzoid pattern? I'm seeing large epithelioid cells with abundant cytoplasm but I'm not sure about the mitotic activity.",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Follow-up image discussion."
        },
        {
          "user_input": "Search the literature on sentinel lymph node biopsy indications for atypical Spitz tumors in adults",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_medical_literature",
          "expected_args": { "query": "sentinel lymph node biopsy indications atypical Spitz tumors adults" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] },
          "notes": "Literature search."
        },
        {
          "user_input": "What's the mechanism of action of pembrolizumab?",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": ["pembrolizumab"], "action_verbs": [] },
          "notes": "General medical knowledge question. No tool needed — MOA is factual knowledge, not a safety lookup."
        }
      ]
    },

    {
      "session_id": "session_05_neurology_stroke",
      "description": "Neurologist evaluating acute stroke with MRI and full patient workup",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "72F brought in by EMS, acute onset expressive aphasia and right hemiparesis. Symptom onset approximately 3 hours ago per family. NIHSS 14. Here's the DWI.",
          "image_base64": "PLACEHOLDER_BASE64_BRAIN_MRI_DWI_72F_LEFT_MCA_TERRITORY_ACUTE_INFARCT",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "IMAGE_DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true },
          "notes": "Acute stroke imaging."
        },
        {
          "user_input": "Which vascular territory does the restricted diffusion correspond to? And does the extent suggest a proximal or distal MCA occlusion?",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Image follow-up."
        },
        {
          "user_input": "She's on apixaban 5mg BID. Check interactions with alteplase.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["apixaban", "alteplase"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["apixaban", "alteplase"], "action_verbs": ["check"] },
          "notes": "Drug interaction check."
        },
        {
          "user_input": "Find patient Doris Yamamoto",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_patient",
          "expected_args": { "name": "Doris Yamamoto" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] },
          "notes": "Patient search."
        },
        {
          "user_input": "Get her chart",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "get_patient_chart",
          "expected_args": { "patient_id": "<from_previous_search_result>" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Chart retrieval via multi-turn context."
        },
        {
          "user_input": "Add an allergy to iodinated contrast — she had a previous anaphylactoid reaction with facial angioedema. Severity was severe.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "add_allergy",
          "expected_args": { "patient_id": "<from_prior_context>", "substance": "iodinated contrast", "reaction": "anaphylactoid reaction with facial angioedema", "severity": "severe" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["add"] },
          "notes": "Write operation. All allergy fields explicitly provided."
        },
        {
          "user_input": "Save a note: Acute left MCA territory infarct on DWI. NIHSS 14. Last known well 3 hours prior. On apixaban — anti-Xa level pending. Discussed with interventional neuroradiology for possible thrombectomy. Contrast allergy documented, premedication protocol ordered if CTA needed.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "save_clinical_note",
          "expected_args": { "patient_id": "<from_prior_context>", "note_type": "progress-note", "note_text": "Acute left MCA territory infarct on DWI. NIHSS 14. Last known well 3 hours prior. On apixaban — anti-Xa level pending. Discussed with interventional neuroradiology for possible thrombectomy. Contrast allergy documented, premedication protocol ordered if CTA needed." },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["apixaban"], "action_verbs": ["save"] },
          "notes": "Write operation."
        }
      ]
    },

    {
      "session_id": "session_06_quickfire_standalone",
      "description": "Rapid independent lookups from a busy clinician between patients",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "What are the boxed warnings on dofetilide?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "dofetilide" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["dofetilide"], "action_verbs": [] },
          "notes": "Clean single-tool lookup. From experiment Q-01."
        },
        {
          "user_input": "Check interactions between phenytoin, valproic acid, and carbamazepine",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["phenytoin", "valproic acid", "carbamazepine"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["phenytoin", "valproic acid", "carbamazepine"], "action_verbs": ["check"] },
          "notes": "3-drug interaction."
        },
        {
          "user_input": "Any active clinical trials for idiopathic pulmonary fibrosis?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "find_clinical_trials",
          "expected_args": { "condition": "idiopathic pulmonary fibrosis" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Clinical trials. Must NOT route to search_medical_literature."
        },
        {
          "user_input": "Search PubMed for GLP-1 receptor agonists and cardiovascular mortality reduction",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_medical_literature",
          "expected_args": { "query": "GLP-1 receptor agonists cardiovascular mortality reduction" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] },
          "notes": "Explicit PubMed reference → literature search."
        },
        {
          "user_input": "What's the difference between DKA and HHS?",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "General medical knowledge. No tool needed."
        },
        {
          "user_input": "Explain the Wells criteria for PE",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "General medical knowledge. No tool needed."
        }
      ]
    },

    {
      "session_id": "session_07_pediatric_cardiology",
      "description": "Pediatric cardiologist managing infant with congenital heart disease",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "Search for patient Baby Boy Torres",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_patient",
          "expected_args": { "name": "Baby Boy Torres" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] },
          "notes": "Unusual patient name format — 'Baby Boy' prefix."
        },
        {
          "user_input": "Pull up his chart please",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "get_patient_chart",
          "expected_args": { "patient_id": "<from_previous_search_result>" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Multi-turn chart retrieval."
        },
        {
          "user_input": "He's 3 months old, 4.8kg, with a large perimembranous VSD. He's on furosemide 1mg/kg BID and captopril. His creatinine is 0.4 which is elevated for his age. How should I adjust the captopril dose?",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": ["furosemide", "captopril"], "action_verbs": [] },
          "notes": "Clinical reasoning about dose adjustment. Chart already retrieved. No tool call needed."
        },
        {
          "user_input": "Check interactions between furosemide, captopril, and digoxin",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["furosemide", "captopril", "digoxin"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["furosemide", "captopril", "digoxin"], "action_verbs": ["check"] },
          "notes": "3-drug interaction."
        },
        {
          "user_input": "Here's his latest CXR. He's been tachypneic and feeding poorly.",
          "image_base64": "PLACEHOLDER_BASE64_CHEST_XRAY_AP_3MONTH_INFANT_CARDIOMEGALY_PULMONARY_OVERCIRCULATION",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "IMAGE_DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true },
          "notes": "Image analysis."
        },
        {
          "user_input": "Search the literature on optimal timing for surgical VSD closure in infants with failure to thrive despite medical management",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_medical_literature",
          "expected_args": { "query": "surgical VSD closure timing infants failure to thrive medical management" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] },
          "notes": "Literature search."
        }
      ]
    },

    {
      "session_id": "session_08_orthopedics_msk",
      "description": "Orthopedic surgeon reviewing knee MRI and exploring treatment options",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "34M recreational soccer player, twisted knee 2 weeks ago. Lachman positive, grade 2 pivot shift. Review this knee MRI.",
          "image_base64": "PLACEHOLDER_BASE64_KNEE_MRI_SAGITTAL_PD_FAT_SAT_34M_ACL_TEAR_BONE_BRUISE",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "IMAGE_DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true },
          "notes": "Image analysis."
        },
        {
          "user_input": "Any signs of meniscal involvement? I want to know about the medial and lateral meniscus separately.",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Image follow-up."
        },
        {
          "user_input": "Completely unrelated — I'm covering for a colleague. What's the safety profile of colchicine? His patient is asking.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "colchicine" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["colchicine"], "action_verbs": [] },
          "notes": "Context switch mid-session. Tests that the model doesn't contaminate this lookup with prior MRI context."
        },
        {
          "user_input": "Back to my ACL patient. Find any clinical trials on quadriceps tendon autograft vs bone-patellar tendon-bone for primary ACL reconstruction",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "find_clinical_trials",
          "expected_args": { "condition": "ACL reconstruction quadriceps tendon autograft vs bone-patellar tendon-bone" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] },
          "notes": "Context switch back. Clinical trials search."
        }
      ]
    },

    {
      "session_id": "session_09_icu_multi_drug",
      "description": "Intensivist managing complex ICU patient with multiple organ concerns",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "Find patient Robert Okafor",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_patient",
          "expected_args": { "name": "Robert Okafor" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] },
          "notes": "Patient search."
        },
        {
          "user_input": "Get his chart",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "get_patient_chart",
          "expected_args": { "patient_id": "<from_previous_search_result>" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Chart retrieval."
        },
        {
          "user_input": "He's on amiodarone, heparin, fentanyl, and midazolam. Run a full interaction check on all four.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["amiodarone", "heparin", "fentanyl", "midazolam"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["amiodarone", "heparin", "fentanyl", "midazolam"], "action_verbs": ["check"] },
          "notes": "4-drug interaction check."
        },
        {
          "user_input": "What are the boxed warnings on amiodarone specifically?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "amiodarone" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["amiodarone"], "action_verbs": [] },
          "notes": "Drug safety lookup."
        },
        {
          "user_input": "His ALT is 280, AST 310, total bili 3.2. He's been on amiodarone for 6 days for recurrent VT. Given his hepatic impairment, should I switch to IV sotalol or lidocaine? He also has an EF of 25%.",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": ["amiodarone", "sotalol", "lidocaine"], "action_verbs": [] },
          "notes": "Clinical reasoning question. Rich prior context (chart + interactions + safety data) already in conversation."
        },
        {
          "user_input": "Search for recent literature on antiarrhythmic management in patients with concurrent hepatic dysfunction and reduced ejection fraction",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_medical_literature",
          "expected_args": { "query": "antiarrhythmic management hepatic dysfunction reduced ejection fraction" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] },
          "notes": "Literature search."
        },
        {
          "user_input": "Alright, let's go with lidocaine. Prescribe IV lidocaine 1mg/kg bolus followed by 1-4mg/min infusion for patient Robert Okafor.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "prescribe_medication",
          "expected_args": { "patient_id": "<from_prior_context>", "medication_name": "lidocaine", "dosage": "1mg/kg bolus then 1-4mg/min infusion", "frequency": "continuous" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["lidocaine"], "action_verbs": ["prescribe"] },
          "notes": "Prescription with complex dosing (bolus + infusion)."
        },
        {
          "user_input": "Save a note: Discontinuing amiodarone due to hepatotoxicity — ALT 280, AST 310, T.bili 3.2 after 6 days of therapy. Transitioning to IV lidocaine for recurrent VT. EF 25%. Avoiding sotalol due to severe LV dysfunction. Will monitor lidocaine levels and LFTs q12h. Hepatology consult placed.",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "save_clinical_note",
          "expected_args": { "patient_id": "<from_prior_context>", "note_type": "progress-note", "note_text": "Discontinuing amiodarone due to hepatotoxicity — ALT 280, AST 310, T.bili 3.2 after 6 days of therapy. Transitioning to IV lidocaine for recurrent VT. EF 25%. Avoiding sotalol due to severe LV dysfunction. Will monitor lidocaine levels and LFTs q12h. Hepatology consult placed." },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["amiodarone", "lidocaine", "sotalol"], "action_verbs": ["save"] },
          "notes": "Clinical note save."
        }
      ]
    },

    {
      "session_id": "session_10_edge_cases",
      "description": "Intentionally tricky, ambiguous, or unusual queries",
      "user_type": "expert",
      "user_inputs": [
        {
          "user_input": "I need help",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Vague request. SYNTHESIZE should ask what help is needed."
        },
        {
          "user_input": "metformin",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin"], "action_verbs": [] },
          "notes": "Single-word, ambiguous. Could mean safety, interactions, mechanism, etc. SYNTHESIZE should ask for clarification or give a general overview. Should NOT auto-trigger check_drug_safety."
        },
        {
          "user_input": "whats the diff btwn losartan and lisinopril? pt has a dry cough on the ACEi",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": ["losartan", "lisinopril"], "action_verbs": [] },
          "notes": "Informal spelling/abbreviations ('whats', 'diff', 'btwn', 'pt', 'ACEi'). This is a clinical knowledge question, not a tool lookup."
        },
        {
          "user_input": "Find patient James Whitfield, pull his chart, and check if any of his current meds interact with each other",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_patient",
          "expected_args": { "name": "James Whitfield" },
          "expected_path": "MULTI_TOOL_3",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find", "pull", "check"] },
          "notes": "Compound multi-step request. Reactive loop: search_patient → get_patient_chart → check_drug_interactions (with meds from chart). Tests reactive step-by-step. Task pattern matching should identify all 3 required tools."
        },
        {
          "user_input": "Look at this scan and also check safety on the contrast agent iohexol",
          "image_base64": "PLACEHOLDER_BASE64_CT_HEAD_NON_CONTRAST_55M_HYPERDENSE_LESION_RIGHT_BASAL_GANGLIA",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "iohexol" },
          "expected_path": "IMAGE_SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["iohexol"], "action_verbs": ["check"], "has_image": true },
          "notes": "Combined image + tool request. INPUT_ASSEMBLY handles image analysis, then TOOL_SELECT picks check_drug_safety. Image findings + drug safety data both flow to SYNTHESIZE."
        },
        {
          "user_input": "thanks, that's all for now",
          "expected_intent": "DIRECT",
          "expected_tool": null,
          "expected_args": {},
          "expected_path": "DIRECT",
          "expected_result_classification": null,
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] },
          "notes": "Session close. No tools."
        }
      ]
    },

    {
      "session_id": "session_11_gastroenterology_gi_bleed",
      "description": "GI specialist managing upper GI bleed with endoscopy images",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "Find patient Ahmed Al-Rashidi", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_patient", "expected_args": { "name": "Ahmed Al-Rashidi" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] }, "notes": "Patient search." },
        { "user_input": "Chart please", "expected_intent": "TOOL_NEEDED", "expected_tool": "get_patient_chart", "expected_args": { "patient_id": "<from_previous_search_result>" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Minimal phrasing — tests intent detection from short inputs." },
        { "user_input": "62M, presented with melena and hematemesis. Hgb dropped from 12.1 to 7.8 over 6 hours. BP 94/58 on arrival. We just scoped him. Here's the endoscopy image.", "image_base64": "PLACEHOLDER_BASE64_ENDOSCOPY_UPPER_GI_62M_GASTRIC_ULCER_VISIBLE_VESSEL_FORREST_IIA", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Endoscopy image analysis." },
        { "user_input": "What Forrest classification would you assign? I see a visible vessel without active bleeding.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Image follow-up, clinical classification." },
        { "user_input": "He's on clopidogrel and aspirin dual antiplatelet therapy post-PCI 8 months ago. Check interactions between clopidogrel, aspirin, and pantoprazole.", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["clopidogrel", "aspirin", "pantoprazole"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["clopidogrel", "aspirin", "pantoprazole"], "action_verbs": ["check"] }, "notes": "3-drug interaction." },
        { "user_input": "Safety profile of IV pantoprazole at high dose — 80mg bolus then 8mg/hr infusion?", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "pantoprazole" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["pantoprazole"], "action_verbs": [] }, "notes": "Drug safety. Dosing context is for SYNTHESIZE." },
        { "user_input": "Search literature on resumption timing of dual antiplatelet therapy after upper GI bleed in post-PCI patients", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "dual antiplatelet therapy resumption timing upper GI bleed post-PCI" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "Prescribe pantoprazole 40mg IV BID for patient Ahmed Al-Rashidi", "expected_intent": "TOOL_NEEDED", "expected_tool": "prescribe_medication", "expected_args": { "patient_id": "<from_prior_context>", "medication_name": "pantoprazole", "dosage": "40mg IV", "frequency": "BID" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["pantoprazole"], "action_verbs": ["prescribe"] }, "notes": "Prescription." },
        { "user_input": "Save a note: EGD showed Forrest IIa gastric ulcer, treated with epinephrine injection and bipolar cautery. DAPT held. IV pantoprazole initiated. Cardiology consulted regarding DAPT resumption timing given recent PCI. Transfused 2u pRBC. Hgb post-transfusion 9.4. Hemodynamically stable post-procedure.", "expected_intent": "TOOL_NEEDED", "expected_tool": "save_clinical_note", "expected_args": { "patient_id": "<from_prior_context>", "note_type": "procedure-note", "note_text": "EGD showed Forrest IIa gastric ulcer, treated with epinephrine injection and bipolar cautery. DAPT held. IV pantoprazole initiated. Cardiology consulted regarding DAPT resumption timing given recent PCI. Transfused 2u pRBC. Hgb post-transfusion 9.4. Hemodynamically stable post-procedure." }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["pantoprazole"], "action_verbs": ["save"] }, "notes": "Procedure note." }
      ]
    },

    {
      "session_id": "session_12_infectious_disease_hiv",
      "description": "ID specialist managing HIV patient with opportunistic infection",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "Hi, I have a complex HIV case.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Conversational opener." },
        { "user_input": "38M, newly diagnosed HIV. CD4 count 47, viral load 680,000. Presenting with subacute headache, confusion, fever. Here's his brain MRI.", "image_base64": "PLACEHOLDER_BASE64_BRAIN_MRI_T1_CONTRAST_38M_RING_ENHANCING_LESIONS_MULTIPLE_TOXOPLASMOSIS", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Image analysis with rich clinical context." },
        { "user_input": "Multiple ring-enhancing lesions — how do I distinguish toxoplasmosis from primary CNS lymphoma without a biopsy?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Clinical reasoning question." },
        { "user_input": "Check interactions between sulfadiazine, pyrimethamine, leucovorin, and bictegravir/emtricitabine/tenofovir alafenamide", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["sulfadiazine", "pyrimethamine", "leucovorin", "bictegravir/emtricitabine/tenofovir alafenamide"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["sulfadiazine", "pyrimethamine", "leucovorin"], "action_verbs": ["check"] }, "notes": "Complex: combination drug bictegravir/emtricitabine/TAF." },
        { "user_input": "What are the boxed warnings on sulfadiazine?", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "sulfadiazine" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["sulfadiazine"], "action_verbs": [] }, "notes": "Drug safety." },
        { "user_input": "Search for literature on timing of ART initiation in HIV patients with CNS toxoplasmosis and very low CD4", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "ART initiation timing HIV CNS toxoplasmosis low CD4" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "Any clinical trials for novel toxoplasmosis treatments in immunocompromised patients?", "expected_intent": "TOOL_NEEDED", "expected_tool": "find_clinical_trials", "expected_args": { "condition": "toxoplasmosis immunocompromised" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Clinical trials. Must NOT route to literature search." }
      ]
    },

    {
      "session_id": "session_13_nephrology_transplant",
      "description": "Nephrologist managing post-transplant patient with rising creatinine",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "Search for patient Linda Johansson", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_patient", "expected_args": { "name": "Linda Johansson" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Patient search." },
        { "user_input": "Get her chart", "expected_intent": "TOOL_NEEDED", "expected_tool": "get_patient_chart", "expected_args": { "patient_id": "<from_previous_search_result>" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Chart retrieval." },
        { "user_input": "She's 14 months post renal transplant, living donor. Baseline Cr 1.1, now trending up to 1.9 over 2 weeks. Tacrolimus trough was 14.2 last check — that's supratherapeutic. She started fluconazole last week for a vaginal yeast infection.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": ["tacrolimus", "fluconazole"], "action_verbs": [] }, "notes": "Clinical presentation. Implicit interaction question but no explicit tool request yet." },
        { "user_input": "Check interactions between tacrolimus and fluconazole", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["tacrolimus", "fluconazole"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["tacrolimus", "fluconazole"], "action_verbs": ["check"] }, "notes": "Drug interaction." },
        { "user_input": "What about tacrolimus, fluconazole, mycophenolate, and prednisone all together?", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["tacrolimus", "fluconazole", "mycophenolate", "prednisone"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["tacrolimus", "fluconazole", "mycophenolate", "prednisone"], "action_verbs": [] }, "notes": "Expanded interaction. 'What about' references prior check." },
        { "user_input": "Here's the transplant kidney ultrasound with Doppler. Evaluate for signs of rejection or obstruction.", "image_base64": "PLACEHOLDER_BASE64_RENAL_ULTRASOUND_DOPPLER_TRANSPLANT_KIDNEY_ELEVATED_RI", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Image analysis." },
        { "user_input": "The resistive index looks elevated. Search the literature on elevated RI in renal transplant as predictor of acute rejection vs calcineurin inhibitor toxicity", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "elevated resistive index renal transplant acute rejection calcineurin inhibitor toxicity" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "Save a note: Rising creatinine likely multifactorial — supratherapeutic tacrolimus (trough 14.2) secondary to fluconazole interaction. Transplant US shows elevated RI. Plan: discontinue fluconazole, switch to topical antifungal, recheck tacrolimus level in 48h, if Cr does not improve consider transplant biopsy to rule out acute rejection.", "expected_intent": "TOOL_NEEDED", "expected_tool": "save_clinical_note", "expected_args": { "patient_id": "<from_prior_context>", "note_type": "progress-note", "note_text": "Rising creatinine likely multifactorial — supratherapeutic tacrolimus (trough 14.2) secondary to fluconazole interaction. Transplant US shows elevated RI. Plan: discontinue fluconazole, switch to topical antifungal, recheck tacrolimus level in 48h, if Cr does not improve consider transplant biopsy to rule out acute rejection." }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["tacrolimus", "fluconazole"], "action_verbs": ["save"] }, "notes": "Clinical note." }
      ]
    },

    {
      "session_id": "session_14_endocrinology_thyroid",
      "description": "Endocrinologist evaluating thyroid nodule with imaging and FNA",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "52F referred for a 2.3cm thyroid nodule found incidentally on carotid US. TSH is 0.8. Here's the dedicated thyroid ultrasound.", "image_base64": "PLACEHOLDER_BASE64_THYROID_ULTRASOUND_52F_SOLID_HYPOECHOIC_NODULE_MICROCALCIFICATIONS_TIRADS5", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Image analysis." },
        { "user_input": "What TI-RADS score would you assign? I see solid composition, hypoechoic, taller-than-wide, and punctate echogenic foci.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Clinical classification follow-up." },
        { "user_input": "FNA came back Bethesda IV — follicular neoplasm. Search the literature on molecular testing panels for Bethesda IV thyroid nodules to avoid diagnostic lobectomy", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "molecular testing Bethesda IV thyroid nodules follicular neoplasm diagnostic lobectomy" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "Find clinical trials for active surveillance of low-risk thyroid cancer", "expected_intent": "TOOL_NEEDED", "expected_tool": "find_clinical_trials", "expected_args": { "condition": "active surveillance low-risk thyroid cancer" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] }, "notes": "Clinical trials." },
        { "user_input": "What's the safety profile of levothyroxine suppression therapy?", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "levothyroxine" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["levothyroxine"], "action_verbs": [] }, "notes": "Drug safety." }
      ]
    },

    {
      "session_id": "session_15_rheumatology_autoimmune",
      "description": "Rheumatologist managing new lupus diagnosis with multi-system involvement",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "28F presenting with malar rash, oral ulcers, arthritis, and a protein/creatinine ratio of 3.2. ANA 1:640 homogeneous, anti-dsDNA 180, low C3/C4. Classic lupus nephritis presentation.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Case presentation." },
        { "user_input": "Check safety profile of mycophenolate mofetil — she's a woman of childbearing age", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "mycophenolate mofetil" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["mycophenolate mofetil"], "action_verbs": ["check"] }, "notes": "Drug safety. Teratogenicity context for synthesis." },
        { "user_input": "Check interactions between mycophenolate, hydroxychloroquine, and prednisone", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["mycophenolate", "hydroxychloroquine", "prednisone"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["mycophenolate", "hydroxychloroquine", "prednisone"], "action_verbs": ["check"] }, "notes": "3-drug interaction." },
        { "user_input": "Search literature on mycophenolate vs cyclophosphamide for induction therapy in class III/IV lupus nephritis", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "mycophenolate vs cyclophosphamide induction therapy class III IV lupus nephritis" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["mycophenolate", "cyclophosphamide"], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "She also has antiphospholipid antibodies. Do I need to anticoagulate prophylactically or only after a thrombotic event?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Clinical reasoning question." },
        { "user_input": "Find clinical trials for belimumab or voclosporin in lupus nephritis", "expected_intent": "TOOL_NEEDED", "expected_tool": "find_clinical_trials", "expected_args": { "condition": "belimumab voclosporin lupus nephritis" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["belimumab", "voclosporin"], "action_verbs": ["find"] }, "notes": "Clinical trials." },
        { "user_input": "Here's her hand X-ray — she's complaining of significant joint pain bilateral MCPs and PIPs.", "image_base64": "PLACEHOLDER_BASE64_HAND_XRAY_AP_28F_BILATERAL_SOFT_TISSUE_SWELLING_NO_EROSIONS_LUPUS_ARTHROPATHY", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Image analysis." }
      ]
    },

    {
      "session_id": "session_16_hematology_blood_smear",
      "description": "Hematologist reviewing peripheral smear and managing pancytopenia",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "71M with progressive fatigue, easy bruising. CBC: WBC 2.1, Hgb 8.4, Plt 62. Here's the peripheral blood smear.", "image_base64": "PLACEHOLDER_BASE64_PERIPHERAL_BLOOD_SMEAR_WRIGHT_GIEMSA_71M_MACROCYTES_HYPERSEGMENTED_NEUTROPHILS_OVAL_MACROCYTES", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Image analysis." },
        { "user_input": "I'm seeing oval macrocytes and hypersegmented neutrophils. B12 and folate are pending. What else should I consider in the differential besides megaloblastic anemia?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Differential diagnosis question." },
        { "user_input": "His B12 came back at 98. Folate is normal. Check safety profile of cyanocobalamin injection.", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "cyanocobalamin" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["cyanocobalamin"], "action_verbs": ["check"] }, "notes": "Drug safety." },
        { "user_input": "He's also on metformin. Does metformin affect B12 absorption?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin"], "action_verbs": [] }, "notes": "Clinical knowledge question — well-known pharmacology fact." },
        { "user_input": "Search literature on optimal B12 replacement protocols and expected hematologic recovery timeline in severe deficiency", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "B12 replacement protocol hematologic recovery severe deficiency" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." }
      ]
    },

    {
      "session_id": "session_17_ophthalmology_fundoscopy",
      "description": "Ophthalmologist evaluating diabetic retinopathy with fundus imaging",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "55M type 2 DM for 18 years, HbA1c 9.2, poorly controlled. Annual eye exam. Here's the right fundus photo.", "image_base64": "PLACEHOLDER_BASE64_FUNDOSCOPY_RIGHT_EYE_55M_MICROANEURYSMS_DOT_BLOT_HEMORRHAGES_HARD_EXUDATES_NPDR", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Fundoscopy image analysis." },
        { "user_input": "Classify the severity of the retinopathy. I'm seeing microaneurysms, dot-blot hemorrhages in all four quadrants, and hard exudates near the macula.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Classification follow-up." },
        { "user_input": "Here's the left eye for comparison.", "image_base64": "PLACEHOLDER_BASE64_FUNDOSCOPY_LEFT_EYE_55M_NEOVASCULARIZATION_DISC_VITREOUS_HEMORRHAGE_PDR", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Second image analysis." },
        { "user_input": "The left eye looks significantly worse. Is that NVD I'm seeing at the disc?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Image follow-up." },
        { "user_input": "Search literature on anti-VEGF injection vs panretinal photocoagulation for proliferative diabetic retinopathy", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "anti-VEGF vs panretinal photocoagulation proliferative diabetic retinopathy" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "Safety profile of intravitreal ranibizumab?", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "ranibizumab" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["ranibizumab"], "action_verbs": [] }, "notes": "Drug safety." },
        { "user_input": "Find clinical trials for faricimab in diabetic retinopathy", "expected_intent": "TOOL_NEEDED", "expected_tool": "find_clinical_trials", "expected_args": { "condition": "faricimab diabetic retinopathy" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["faricimab"], "action_verbs": ["find"] }, "notes": "Clinical trials." }
      ]
    },

    {
      "session_id": "session_18_obgyn_preeclampsia",
      "description": "OB/GYN managing preeclampsia with HELLP syndrome features",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "Find patient Sarah Blackwood", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_patient", "expected_args": { "name": "Sarah Blackwood" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] }, "notes": "Patient search." },
        { "user_input": "Get her chart", "expected_intent": "TOOL_NEEDED", "expected_tool": "get_patient_chart", "expected_args": { "patient_id": "<from_previous_search_result>" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Chart retrieval." },
        { "user_input": "She's 31 weeks pregnant, G2P1. BP 168/104, proteinuria 4.2g/24h, platelets 82, AST 156, LDH 680. I'm worried about HELLP.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Case presentation." },
        { "user_input": "What are the diagnostic criteria for HELLP syndrome? Does she meet them?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Clinical reasoning with data from prior turns." },
        { "user_input": "Safety profile of magnesium sulfate in the context of renal impairment — her Cr is 1.4", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "magnesium sulfate" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["magnesium sulfate"], "action_verbs": [] }, "notes": "Drug safety." },
        { "user_input": "Check interactions between magnesium sulfate, labetalol, and nifedipine", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["magnesium sulfate", "labetalol", "nifedipine"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["magnesium sulfate", "labetalol", "nifedipine"], "action_verbs": ["check"] }, "notes": "3-drug interaction." },
        { "user_input": "Search literature on expectant management vs immediate delivery for HELLP syndrome at 31 weeks", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "expectant management vs immediate delivery HELLP syndrome 31 weeks" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "Prescribe betamethasone 12mg IM for patient Sarah Blackwood for fetal lung maturity", "expected_intent": "TOOL_NEEDED", "expected_tool": "prescribe_medication", "expected_args": { "patient_id": "<from_prior_context>", "medication_name": "betamethasone", "dosage": "12mg IM", "frequency": "once" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["betamethasone"], "action_verbs": ["prescribe"] }, "notes": "Prescription." },
        { "user_input": "Save a note: 31w G2P1 with severe features preeclampsia, evolving HELLP — Plt 82, AST 156, LDH 680, protein 4.2g. Initiated MgSO4 for seizure prophylaxis with close monitoring given Cr 1.4. Betamethasone administered for fetal lung maturity. Plan for delivery within 24-48h after steroid course if stable, sooner if deterioration. MFM and NICU aware.", "expected_intent": "TOOL_NEEDED", "expected_tool": "save_clinical_note", "expected_args": { "patient_id": "<from_prior_context>", "note_type": "progress-note", "note_text": "31w G2P1 with severe features preeclampsia, evolving HELLP — Plt 82, AST 156, LDH 680, protein 4.2g. Initiated MgSO4 for seizure prophylaxis with close monitoring given Cr 1.4. Betamethasone administered for fetal lung maturity. Plan for delivery within 24-48h after steroid course if stable, sooner if deterioration. MFM and NICU aware." }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["betamethasone"], "action_verbs": ["save"] }, "notes": "Clinical note." }
      ]
    },

    {
      "session_id": "session_19_psychiatry_polypharmacy",
      "description": "Psychiatrist managing treatment-resistant depression with complex medication regimen",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "I have a patient on a complicated psych med regimen and I need to do a thorough interaction check.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Conversational setup." },
        { "user_input": "She's on sertraline 200mg, aripiprazole 5mg augmentation, lithium 900mg, and trazodone 100mg for sleep. Check all interactions.", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["sertraline", "aripiprazole", "lithium", "trazodone"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["sertraline", "aripiprazole", "lithium", "trazodone"], "action_verbs": ["check"] }, "notes": "4-drug interaction." },
        { "user_input": "What's her serotonin syndrome risk with this combination?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Clinical question referencing prior interaction data." },
        { "user_input": "I want to switch from sertraline to an MAOI — tranylcypromine specifically. What's the required washout period?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": ["sertraline", "tranylcypromine"], "action_verbs": [] }, "notes": "Clinical knowledge question." },
        { "user_input": "What are the boxed warnings on tranylcypromine?", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "tranylcypromine" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["tranylcypromine"], "action_verbs": [] }, "notes": "Drug safety." },
        { "user_input": "Search literature on tranylcypromine efficacy in treatment-resistant depression after SSRI failure", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "tranylcypromine efficacy treatment-resistant depression SSRI failure" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["tranylcypromine"], "action_verbs": ["search"] }, "notes": "Literature search." },
        { "user_input": "Find clinical trials for psilocybin-assisted therapy in treatment-resistant depression", "expected_intent": "TOOL_NEEDED", "expected_tool": "find_clinical_trials", "expected_args": { "condition": "psilocybin treatment-resistant depression" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["psilocybin"], "action_verbs": ["find"] }, "notes": "Clinical trials." },
        { "user_input": "Check safety profile on lithium — specifically thyroid and renal long-term effects. She's been on it for 6 years.", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "lithium" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["lithium"], "action_verbs": ["check"] }, "notes": "Drug safety." }
      ]
    },

    {
      "session_id": "session_20_emergency_trauma",
      "description": "Trauma surgeon evaluating polytrauma patient with multiple imaging",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "MVC, 29M unrestrained driver, hemodynamically unstable on arrival. GCS 11. Here's the chest X-ray from trauma bay.", "image_base64": "PLACEHOLDER_BASE64_CHEST_XRAY_AP_SUPINE_29M_LEFT_HEMOTHORAX_MEDIASTINAL_WIDENING_RIB_FRACTURES", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Trauma CXR image analysis." },
        { "user_input": "I see opacification of the left hemithorax. Is there also mediastinal widening? Worried about aortic injury.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Image follow-up." },
        { "user_input": "CT angio is back. Here's the chest CT.", "image_base64": "PLACEHOLDER_BASE64_CT_CHEST_CONTRAST_29M_TRAUMATIC_AORTIC_INJURY_ISTHMUS_PSEUDOANEURYSM", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "CT image analysis." },
        { "user_input": "Confirm or deny aortic injury. What grade does this look like?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Image follow-up." },
        { "user_input": "He also has a pelvic fracture. Here's the pelvis CT.", "image_base64": "PLACEHOLDER_BASE64_CT_PELVIS_29M_OPEN_BOOK_PELVIC_FRACTURE_BILATERAL_SACROILIAC_DISRUPTION", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Third image in session." },
        { "user_input": "Check interactions between tranexamic acid, heparin, and ketamine", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["tranexamic acid", "heparin", "ketamine"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["tranexamic acid", "heparin", "ketamine"], "action_verbs": ["check"] }, "notes": "Drug interaction." },
        { "user_input": "Search literature on optimal sequencing of TEVAR vs pelvic fixation in polytrauma with concurrent aortic and pelvic injuries", "expected_intent": "TOOL_NEEDED", "expected_tool": "search_medical_literature", "expected_args": { "query": "TEVAR vs pelvic fixation polytrauma concurrent aortic pelvic injuries sequencing" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] }, "notes": "Literature search." }
      ]
    },

    {
      "_comment": "Sessions 21-40 follow the same annotation pattern. For brevity, only structurally novel or critical sessions are shown with full annotations. The remaining sessions (21-40) retain their original user_inputs and should be annotated following the patterns above.",

      "session_id": "session_21_rural_gp_limited_resources",
      "description": "Rural GP with limited specialist access making triage decisions",
      "user_type": "expert",
      "user_inputs": [
        { "user_input": "Hey DocGemma. I'm a solo GP in a rural clinic, nearest hospital is 3 hours away. Need your help with a couple patients today.", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Conversational setup." },
        { "user_input": "First patient: 68F with sudden onset severe headache, worst of her life, started 2 hours ago. No focal neuro deficits on my exam. BP 182/96. I don't have CT here. What should I do?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Urgent clinical reasoning — thunderclap headache. No tools, pure clinical guidance." },
        { "user_input": "Second patient while I arrange the transfer: 42M diabetic, here for routine follow-up. HbA1c 8.4, on metformin 1000mg BID and glimepiride 4mg. Cr is 1.6 and was 1.2 six months ago. How should I adjust his regimen?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin", "glimepiride"], "action_verbs": [] }, "notes": "Clinical reasoning. Context switch between patients." },
        { "user_input": "Check interactions between metformin, glimepiride, and empagliflozin — I'm thinking of adding an SGLT2i", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["metformin", "glimepiride", "empagliflozin"] }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin", "glimepiride", "empagliflozin"], "action_verbs": ["check"] }, "notes": "Drug interaction." },
        { "user_input": "He also has a foot wound that's not healing well. Here's a photo I took with my phone.", "image_base64": "PLACEHOLDER_BASE64_CLINICAL_PHOTO_DIABETIC_FOOT_ULCER_PLANTAR_42M_WAGNER_GRADE_2", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "IMAGE_DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [], "has_image": true }, "notes": "Clinical photo analysis." },
        { "user_input": "How would you classify that ulcer? And at what point should I transfer him for vascular surgery evaluation?", "expected_intent": "DIRECT", "expected_tool": null, "expected_args": {}, "expected_path": "DIRECT", "expected_result_classification": null, "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": [] }, "notes": "Clinical reasoning follow-up." },
        { "user_input": "Safety profile of empiric oral amoxicillin-clavulanate for the wound? He has a documented penicillin allergy — rash only, no anaphylaxis.", "expected_intent": "TOOL_NEEDED", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "amoxicillin-clavulanate" }, "expected_path": "SINGLE_TOOL", "expected_result_classification": "success_rich", "expected_entities": { "patient_ids": [], "drug_mentions": ["amoxicillin-clavulanate"], "action_verbs": [] }, "notes": "Drug safety with allergy context for SYNTHESIZE to address." }
      ]
    },

    {
      "session_id": "session_22_through_40_stub",
      "_comment": "Sessions 22-40 retain their original user_inputs from the v1 file. They follow identical annotation patterns to sessions 1-21 above. The full annotations would be generated programmatically using the same rules: greetings/case_presentations/knowledge_questions → DIRECT; explicit tool requests → TOOL_NEEDED with appropriate tool/args; image messages → IMAGE_DIRECT or IMAGE_SINGLE_TOOL. The remaining 19 sessions are omitted here to keep this file focused on the NEW content below: error sessions and unit tests."
    }
  ],

  "error_sessions": [
    {
      "session_id": "error_session_01_multiple_patient_matches",
      "description": "Tests DETERMINISTIC_ROUTER ask_user trigger when search_patient returns multiple matches. Model scores 0% on ask_user — this MUST be handled by code.",
      "user_type": "expert",
      "tests_node": "DETERMINISTIC_ROUTER → ERROR_HANDLER(ask_user)",
      "empirical_basis": "Part III §30: ask_user accuracy = 0%. Part III §35: skip_and_continue accuracy = 0%.",
      "user_inputs": [
        {
          "user_input": "Find patient Maria Garcia",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_patient",
          "expected_args": { "name": "Maria Garcia" },
          "expected_path": "SINGLE_TOOL",
          "mock_tool_result": {
            "status": "success",
            "data": {
              "matches": [
                { "patient_id": "pat-44201", "name": "Maria L. Garcia", "dob": "1978-03-15", "mrn": "MRN-0044201" },
                { "patient_id": "pat-67892", "name": "Maria Elena Garcia", "dob": "1955-11-02", "mrn": "MRN-0067892" },
                { "patient_id": "pat-91034", "name": "Maria Garcia-Torres", "dob": "1992-07-28", "mrn": "MRN-0091034" }
              ],
              "total_matches": 3
            }
          },
          "expected_result_classification": "success_rich",
          "expected_router_action": "ASK_USER",
          "expected_clarification": "I found 3 patients matching 'Maria Garcia'. Which one did you mean?",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["find"] },
          "notes": "The LLM classifies the result as success_rich (data was returned). But DETERMINISTIC_ROUTER detects patient_matches > 1 and forces ask_user. The model would never generate ask_user on its own (0% accuracy)."
        },
        {
          "user_input": "The second one — Maria Elena Garcia, born 1955",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "get_patient_chart",
          "expected_args": { "patient_id": "pat-67892" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": ["pat-67892"], "drug_mentions": [], "action_verbs": [] },
          "notes": "User clarifies. System resolves to pat-67892 from prior context. Normal single-tool flow resumes."
        },
        {
          "user_input": "Check her current meds for interactions",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "get_patient_chart",
          "expected_args": { "patient_id": "pat-67892" },
          "expected_path": "MULTI_TOOL_2",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["check"] },
          "notes": "Compound: get_patient_chart → extract meds → check_drug_interactions. If chart already in context from turn 2, may go directly to interactions."
        }
      ]
    },

    {
      "session_id": "error_session_02_api_timeout_and_retry",
      "description": "Tests ERROR_HANDLER retry logic on transient API failures. Model scores 92% on retry_same vs retry_different — this IS appropriate for LLM.",
      "user_type": "expert",
      "tests_node": "ERROR_HANDLER(LLM retry decision)",
      "empirical_basis": "Part III §35: retry_same accuracy = 100%, retry_different_args = 83%.",
      "user_inputs": [
        {
          "user_input": "Check FDA warnings for amiodarone",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "amiodarone" },
          "expected_path": "ERROR_RETRY",
          "mock_tool_result_attempt_1": {
            "status": "error",
            "error_type": "timeout",
            "error_message": "Request to drug safety API timed out after 10000ms",
            "raw_error": "ConnectionTimeoutError: https://api.openfda.gov/drug/label.json?search=amiodarone"
          },
          "expected_result_classification_attempt_1": "error_retryable",
          "expected_error_handler_action": "LLM_DECIDE_RETRY",
          "expected_retry_strategy": "retry_same",
          "mock_tool_result_attempt_2": {
            "status": "success",
            "data": { "boxed_warnings": ["Pulmonary toxicity", "Hepatotoxicity", "Proarrhythmia"] }
          },
          "expected_result_classification_attempt_2": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["amiodarone"], "action_verbs": ["check"] },
          "notes": "First call times out. RESULT_CLASSIFY → error_retryable. ROUTER → ERROR_HANDLER. Deterministic check: not ask_user, not skip (retry_count=0 < MAX_RETRIES=2). LLM decides retry_same (92% accurate for timeouts). Second attempt succeeds. Verify: (1) pre-formatted error message used, not raw error, (2) retry_count incremented, (3) synthesis uses successful result only."
        },
        {
          "user_input": "Now check interactions with digoxin",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["amiodarone", "digoxin"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["amiodarone", "digoxin"], "action_verbs": ["check"] },
          "notes": "Normal flow after error recovery. Verify retry state was reset between turns."
        }
      ]
    },

    {
      "session_id": "error_session_03_drug_not_in_database",
      "description": "Tests ERROR_HANDLER skip_and_continue when a drug is not found. Model scores 0% on skip — must be deterministic.",
      "user_type": "expert",
      "tests_node": "ERROR_HANDLER(skip_and_continue)",
      "empirical_basis": "Part III §35: skip_and_continue accuracy = 0%.",
      "user_inputs": [
        {
          "user_input": "Check safety profile of investigational compound XYZ-4829",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "XYZ-4829" },
          "expected_path": "ERROR_SKIP",
          "mock_tool_result": {
            "status": "error",
            "error_type": "drug_not_in_database",
            "error_message": "No FDA label data found for 'XYZ-4829'",
            "drug_name": "XYZ-4829"
          },
          "expected_result_classification": "error_fatal",
          "expected_error_handler_action": "SKIP",
          "expected_skip_message": "XYZ-4829 was not found in the drug database.",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["check"] },
          "notes": "Drug not in DB → error_fatal → DETERMINISTIC check: drug_not_in_database → SKIP. Model would retry forever (0% skip accuracy). Synthesis should clearly state the drug was not found, NOT hallucinate safety data from pretrained knowledge."
        },
        {
          "user_input": "What about checking interactions between XYZ-4829 and metformin?",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["XYZ-4829", "metformin"] },
          "expected_path": "ERROR_SKIP",
          "mock_tool_result": {
            "status": "error",
            "error_type": "drug_not_in_database",
            "error_message": "No interaction data found for 'XYZ-4829'",
            "drug_name": "XYZ-4829"
          },
          "expected_result_classification": "error_fatal",
          "expected_error_handler_action": "SKIP",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin"], "action_verbs": ["check"] },
          "notes": "Same pattern. Synthesis should state limitations clearly."
        },
        {
          "user_input": "OK, check metformin safety instead — at least that should work",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "metformin" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin"], "action_verbs": ["check"] },
          "notes": "Normal recovery after skipped errors."
        }
      ]
    },

    {
      "session_id": "error_session_04_max_retries_exhausted",
      "description": "Tests ERROR_HANDLER skip after MAX_RETRIES (2) are exhausted. Service persistently down.",
      "user_type": "expert",
      "tests_node": "ERROR_HANDLER(max_retry → skip)",
      "empirical_basis": "Part III §35: Model never generates skip. Must be hardcoded at retry_count >= MAX_RETRIES.",
      "user_inputs": [
        {
          "user_input": "Search PubMed for recent meta-analyses on SGLT2 inhibitors in heart failure",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_medical_literature",
          "expected_args": { "query": "meta-analyses SGLT2 inhibitors heart failure" },
          "expected_path": "ERROR_SKIP",
          "mock_tool_result_attempt_1": {
            "status": "error",
            "error_type": "server_error",
            "error_message": "PubMed API returned HTTP 503 Service Unavailable"
          },
          "mock_tool_result_attempt_2": {
            "status": "error",
            "error_type": "server_error",
            "error_message": "PubMed API returned HTTP 503 Service Unavailable"
          },
          "mock_tool_result_attempt_3": "NOT_REACHED",
          "expected_result_classification_attempt_1": "error_retryable",
          "expected_error_handler_action_attempt_1": "LLM_DECIDE_RETRY → retry_same",
          "expected_result_classification_attempt_2": "error_retryable",
          "expected_error_handler_action_attempt_2": "SKIP (retry_count=2 >= MAX_RETRIES)",
          "expected_skip_message": "Medical Literature search is currently unavailable. Please try again shortly.",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["search"] },
          "notes": "Attempt 1 fails → retry. Attempt 2 fails → retry_count reaches MAX_RETRIES → deterministic SKIP regardless of what LLM would say. Third attempt is never made. Synthesis acknowledges unavailability. Verify: no pretrained knowledge hallucination about SGLT2i."
        }
      ]
    },

    {
      "session_id": "error_session_05_missing_args_ask_user",
      "description": "Tests ERROR_HANDLER ask_user when required arguments can't be extracted.",
      "user_type": "expert",
      "tests_node": "ERROR_HANDLER(ask_user for missing args)",
      "empirical_basis": "Part II §24: name field 50% miss rate, drug_name 43.8% miss rate.",
      "user_inputs": [
        {
          "user_input": "Prescribe the usual dose for the patient",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "prescribe_medication",
          "expected_args": { "patient_id": null, "medication_name": null, "dosage": null, "frequency": null },
          "expected_path": "ERROR_ASK_USER",
          "expected_validation_failure": {
            "missing_fields": ["patient_id", "medication_name", "dosage", "frequency"]
          },
          "expected_error_handler_action": "ASK_USER",
          "expected_clarification": "I need more information to complete this prescription: the patient ID or name, medication name, dosage, and frequency.",
          "expected_entities": { "patient_ids": [], "drug_mentions": [], "action_verbs": ["prescribe"] },
          "notes": "TOOL_SELECT may pick prescribe_medication from 'prescribe' verb, but Stage 2 arg extraction fails on all fields. TOOL_EXECUTE validation catches missing required args before execution. Deterministic → ASK_USER. Model would try to retry (0% ask_user accuracy)."
        },
        {
          "user_input": "Sorry — prescribe lisinopril 10mg daily for patient pat-44201",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "prescribe_medication",
          "expected_args": { "patient_id": "pat-44201", "medication_name": "lisinopril", "dosage": "10mg", "frequency": "daily" },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": ["pat-44201"], "drug_mentions": ["lisinopril"], "action_verbs": ["prescribe"] },
          "notes": "User provides all required info. Normal flow. INPUT_ASSEMBLY extracts patient_id via regex and drug name via dictionary."
        }
      ]
    },

    {
      "session_id": "error_session_06_loop_termination_stress_test",
      "description": "Tests all loop termination conditions: max_steps, duplicate detection, and task pattern satisfaction.",
      "user_type": "expert",
      "tests_node": "DETERMINISTIC_ROUTER loop termination",
      "empirical_basis": "Part III §34: Sufficiency accuracy = 0%. Part III §33: reactive never stops on its own.",
      "user_inputs": [
        {
          "user_input": "Find patient John Smith, pull his chart, check if his metformin is safe given his labs, check his drug interactions, and search for any clinical trials for his condition",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "search_patient",
          "expected_args": { "name": "John Smith" },
          "expected_path": "MULTI_TOOL_3",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["metformin"], "action_verbs": ["find", "pull", "check", "search"] },
          "notes": "User requests 5 actions but MAX_STEPS=4. Expected reactive loop: (1) search_patient → success, (2) get_patient_chart → success, (3) check_drug_safety(metformin) → success, (4) MAX_STEPS reached → force SYNTHESIZE. The model would never voluntarily stop (0% sufficiency accuracy). Verify: (a) system stops at step 4, (b) synthesis explains what was completed and what wasn't, (c) system does NOT attempt a 5th tool call.",
          "expected_loop_trace": [
            { "step": 1, "tool": "search_patient", "result": "success_rich", "router_action": "TOOL_SELECT" },
            { "step": 2, "tool": "get_patient_chart", "result": "success_rich", "router_action": "TOOL_SELECT" },
            { "step": 3, "tool": "check_drug_safety", "result": "success_rich", "router_action": "TOOL_SELECT" },
            { "step": 4, "tool": "check_drug_interactions", "result": "success_rich", "router_action": "SYNTHESIZE (MAX_STEPS)" }
          ]
        },
        {
          "user_input": "Check interactions between lisinopril and metformin",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_interactions",
          "expected_args": { "drug_names": ["lisinopril", "metformin"] },
          "expected_path": "SINGLE_TOOL",
          "expected_result_classification": "success_rich",
          "mock_tool_result": {
            "status": "success",
            "data": { "interactions": [] }
          },
          "expected_entities": { "patient_ids": [], "drug_mentions": ["lisinopril", "metformin"], "action_verbs": ["check"] },
          "notes": "After MAX_STEPS forced termination, verify step_count resets for the next turn."
        },
        {
          "user_input": "Check safety of lisinopril",
          "expected_intent": "TOOL_NEEDED",
          "expected_tool": "check_drug_safety",
          "expected_args": { "drug_name": "lisinopril" },
          "expected_path": "SINGLE_TOOL",
          "mock_tool_result_step1": {
            "status": "success",
            "data": { "warnings": ["ACE inhibitor class warnings"] }
          },
          "expected_result_classification": "success_rich",
          "expected_entities": { "patient_ids": [], "drug_mentions": ["lisinopril"], "action_verbs": ["check"] },
          "notes": "Simple single-tool call. If the reactive model tries to call check_drug_safety again with identical args, DETERMINISTIC_ROUTER must catch the duplicate and force SYNTHESIZE. Tests duplicate detection."
        }
      ]
    }
  ],

  "unit_tests": {
    "_description": "Isolated node-level tests. Each test provides a single input and expected output for ONE node. No multi-turn context. Used for debugging individual nodes during implementation.",

    "intent_classify_tests": [
      { "id": "IC-01", "input": "Hello", "expected_intent": "DIRECT", "expected_task_summary_contains": "greeting", "notes": "Simplest case." },
      { "id": "IC-02", "input": "What is hypertension?", "expected_intent": "DIRECT", "expected_task_summary_contains": "hypertension", "notes": "General medical knowledge." },
      { "id": "IC-03", "input": "Explain the mechanism of action of metformin", "expected_intent": "DIRECT", "expected_task_summary_contains": "metformin", "notes": "Factual, no tool needed." },
      { "id": "IC-04", "input": "Check FDA warnings for dofetilide", "expected_intent": "TOOL_NEEDED", "expected_suggested_tool": "check_drug_safety", "notes": "Clear single-tool intent." },
      { "id": "IC-05", "input": "Find patient John Smith", "expected_intent": "TOOL_NEEDED", "expected_suggested_tool": "search_patient", "notes": "Patient search." },
      { "id": "IC-06", "input": "Search PubMed for SGLT2 inhibitors in heart failure", "expected_intent": "TOOL_NEEDED", "expected_suggested_tool": "search_medical_literature", "notes": "Literature search." },
      { "id": "IC-07", "input": "thanks", "expected_intent": "DIRECT", "notes": "Session closing." },
      { "id": "IC-08", "input": "I need help", "expected_intent": "DIRECT", "notes": "Vague — should ask for clarification, not trigger tools." },
      { "id": "IC-09", "input": "metformin", "expected_intent": "DIRECT", "notes": "Single word, ambiguous. Should NOT auto-trigger check_drug_safety." },
      { "id": "IC-10", "input": "What are the Wells criteria for PE?", "expected_intent": "DIRECT", "notes": "Clinical knowledge — no tool." }
    ],

    "tool_select_tests": [
      { "id": "TS-01", "query": "Check FDA warnings for dofetilide", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "dofetilide" }, "notes": "Clean drug safety." },
      { "id": "TS-02", "query": "Check interactions between warfarin and aspirin", "expected_tool": "check_drug_interactions", "expected_args": { "drug_names": ["warfarin", "aspirin"] }, "notes": "Drug interaction." },
      { "id": "TS-03", "query": "Find clinical trials for idiopathic pulmonary fibrosis", "expected_tool": "find_clinical_trials", "expected_args": { "condition": "idiopathic pulmonary fibrosis" }, "notes": "Must NOT route to search_medical_literature (56% confusion rate §23)." },
      { "id": "TS-04", "query": "Search PubMed for GLP-1 agonists cardiovascular outcomes", "expected_tool": "search_medical_literature", "expected_args": { "query": "GLP-1 agonists cardiovascular outcomes" }, "notes": "Explicit PubMed reference." },
      { "id": "TS-05", "query": "Find patient Maria Garcia", "expected_tool": "search_patient", "expected_args": { "name": "Maria Garcia" }, "notes": "Patient search." },
      { "id": "TS-06", "query": "Check amoxicillin information for my patient", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "amoxicillin" }, "notes": "CRITICAL: 'for my patient' must NOT trigger get_patient_chart. §23 Q-15 regression test." },
      { "id": "TS-07", "query": "Write a note for patient abc-123 about today's visit", "expected_tool": "save_clinical_note", "expected_args": { "patient_id": "abc-123" }, "notes": "CRITICAL: 'patient abc-123' must NOT trigger get_patient_chart. §23 Q-20 regression test." },
      { "id": "TS-08", "query": "Prescribe lisinopril 10mg daily for patient pat-55678", "expected_tool": "prescribe_medication", "expected_args": { "patient_id": "pat-55678", "medication_name": "lisinopril", "dosage": "10mg", "frequency": "daily" }, "notes": "All args present in query." },
      { "id": "TS-09", "query": "Document that patient abc-123 is allergic to penicillin — had anaphylaxis, severe", "expected_tool": "add_allergy", "expected_args": { "patient_id": "abc-123", "substance": "penicillin", "reaction": "anaphylaxis", "severity": "severe" }, "notes": "Allergy documentation." },
      { "id": "TS-10", "query": "Are there any new treatments being studied for multiple sclerosis?", "expected_tool": "find_clinical_trials", "expected_args": { "condition": "multiple sclerosis" }, "notes": "'being studied' → clinical trials. Acceptable: search_medical_literature (genuinely ambiguous per §23 Q-13)." },
      { "id": "TS-11", "query": "Is metformin safe for a patient with CKD stage 4?", "expected_tool": "check_drug_safety", "expected_args": { "drug_name": "metformin" }, "notes": "Acceptable: search_medical_literature (genuinely ambiguous per §23 Q-11). But check_drug_safety is the primary intent." },
      { "id": "TS-12", "query": "Get chart for patient f47ac10b-58cc-4372-a567-0e02b2c3d479", "expected_tool": "get_patient_chart", "expected_args": { "patient_id": "f47ac10b-58cc-4372-a567-0e02b2c3d479" }, "notes": "Full UUID patient ID. INPUT_ASSEMBLY regex should extract this." }
    ],

    "result_classify_tests": [
      { "id": "RC-01", "tool_label": "Drug Safety Report", "result_data": { "drug": "dofetilide", "boxed_warnings": ["Torsade de Pointes", "ECG monitoring required"], "contraindications": ["QT prolongation"] }, "expected_quality": "success_rich", "notes": "Complete safety data." },
      { "id": "RC-02", "tool_label": "Medical Literature", "result_data": { "articles": [] }, "expected_quality": "no_results", "notes": "Empty results." },
      { "id": "RC-03", "tool_label": "Drug Safety Report", "result_data": { "error": "The Drug Safety Report was temporarily unavailable. Please try again shortly." }, "expected_quality": "error_retryable", "notes": "Pre-formatted timeout error." },
      { "id": "RC-04", "tool_label": "Patient Search", "result_data": { "matches": [{ "patient_id": "pat-12345", "name": "John Smith" }] }, "expected_quality": "success_rich", "notes": "Single patient match." },
      { "id": "RC-05", "tool_label": "Drug Interaction Check", "result_data": { "interactions": [{ "drug_pair": "warfarin-aspirin", "severity": "major" }] }, "expected_quality": "success_rich", "notes": "Interaction found." },
      { "id": "RC-06", "tool_label": "Drug Interaction Check", "result_data": { "interactions": [] }, "expected_quality": "success_partial", "notes": "No interactions found — partial because the absence of interaction data is itself useful but less rich." },
      { "id": "RC-07", "tool_label": "Clinical Trials", "result_data": { "trials": [{ "nct_id": "NCT12345", "title": "Phase III trial" }] }, "expected_quality": "success_rich", "notes": "Trial found." },
      { "id": "RC-08", "tool_label": "Drug Safety Report", "result_data": { "error": "XYZ-4829 was not found in the drug database." }, "expected_quality": "error_fatal", "notes": "Drug not in DB — permanent error, no retry." }
    ],

    "deterministic_router_tests": [
      { "id": "DR-01", "last_classification": "success_rich", "step_count": 1, "tools_called": ["check_drug_safety"], "query": "Check FDA warnings for dofetilide", "expected_action": "SYNTHESIZE", "notes": "Single tool done, task satisfied." },
      { "id": "DR-02", "last_classification": "success_rich", "step_count": 1, "tools_called": ["search_patient"], "query": "Find patient John and check his chart", "expected_action": "TOOL_SELECT", "notes": "Task pattern: 'chart' keyword requires get_patient_chart, not yet called." },
      { "id": "DR-03", "last_classification": "error_retryable", "step_count": 1, "retry_count": 0, "expected_action": "ERROR_HANDLER", "notes": "Error → route to error handler." },
      { "id": "DR-04", "last_classification": "success_rich", "step_count": 4, "tools_called": ["search_patient", "get_patient_chart", "check_drug_safety", "check_drug_interactions"], "query": "anything", "expected_action": "SYNTHESIZE", "notes": "MAX_STEPS reached → forced termination regardless of task pattern." },
      { "id": "DR-05", "last_classification": "no_results", "step_count": 1, "tools_called": ["search_medical_literature"], "query": "Search literature on X", "expected_action": "SYNTHESIZE", "notes": "No results is still a valid terminal state — synthesis reports nothing found." },
      { "id": "DR-06", "last_classification": "success_rich", "step_count": 2, "tools_called": ["check_drug_safety", "check_drug_safety"], "same_args": true, "query": "Check safety of lisinopril", "expected_action": "SYNTHESIZE", "notes": "Duplicate tool call detection → forced termination." },
      { "id": "DR-07", "last_classification": "success_rich", "step_count": 2, "tools_called": ["search_patient", "get_patient_chart"], "query": "Find patient and check chart", "expected_action": "SYNTHESIZE", "notes": "Task pattern satisfied: both search_patient and get_patient_chart called." },
      { "id": "DR-08", "last_classification": "success_rich", "step_count": 1, "tools_called": ["search_patient"], "query": "Find patient John, check chart, and verify drug safety", "expected_action": "TOOL_SELECT", "notes": "Task has 'chart' + 'safety' keywords → requires more tools." }
    ],

    "error_handler_tests": [
      { "id": "EH-01", "error_type": "multiple_patient_matches", "retry_count": 0, "expected_action": "ASK_USER", "notes": "Deterministic: always ask_user for multi-match." },
      { "id": "EH-02", "error_type": "timeout", "retry_count": 0, "expected_action": "LLM_DECIDE_RETRY", "notes": "Retryable, under max — let LLM decide." },
      { "id": "EH-03", "error_type": "timeout", "retry_count": 2, "expected_action": "SKIP", "notes": "Retryable but MAX_RETRIES reached — deterministic skip." },
      { "id": "EH-04", "error_type": "drug_not_in_database", "retry_count": 0, "expected_action": "SKIP", "notes": "Permanent error — deterministic skip regardless of retry count." },
      { "id": "EH-05", "error_type": "missing_required_args", "retry_count": 0, "expected_action": "ASK_USER", "notes": "Can't extract needed info — ask user." },
      { "id": "EH-06", "error_type": "ambiguous_drug_name", "retry_count": 0, "expected_action": "ASK_USER", "notes": "Ambiguous → ask for clarification." },
      { "id": "EH-07", "error_type": "server_error", "retry_count": 1, "expected_action": "SKIP", "notes": "service_unavailable after 1 retry → skip." },
      { "id": "EH-08", "error_type": "rate_limit", "retry_count": 0, "expected_action": "LLM_DECIDE_RETRY", "notes": "Rate limit is transient — LLM decides retry strategy." },
      { "id": "EH-09", "error_type": "empty_results", "retry_count": 0, "expected_action": "LLM_DECIDE_RETRY", "notes": "Empty results may benefit from retry_different_args." },
      { "id": "EH-10", "error_type": "invalid_response", "retry_count": 0, "expected_action": "LLM_DECIDE_RETRY", "notes": "Malformed response — worth retrying once." }
    ],

    "input_assembly_tests": [
      { "id": "IA-01", "input": "Check safety of metformin for patient abc-123", "expected_patient_ids": ["abc-123"], "expected_drug_mentions": ["metformin"], "expected_action_verbs": ["check"], "expected_has_image": false },
      { "id": "IA-02", "input": "Find patient f47ac10b-58cc-4372-a567-0e02b2c3d479", "expected_patient_ids": ["f47ac10b-58cc-4372-a567-0e02b2c3d479"], "expected_drug_mentions": [], "expected_action_verbs": ["find"], "expected_has_image": false },
      { "id": "IA-03", "input": "Check interactions between warfarin, lisinopril, and metformin", "expected_patient_ids": [], "expected_drug_mentions": ["warfarin", "lisinopril", "metformin"], "expected_action_verbs": ["check"], "expected_has_image": false },
      { "id": "IA-04", "input": "Hello", "expected_patient_ids": [], "expected_drug_mentions": [], "expected_action_verbs": [], "expected_has_image": false },
      { "id": "IA-05", "input": "Prescribe empagliflozin 10mg for pat-78234", "expected_patient_ids": ["pat-78234"], "expected_drug_mentions": ["empagliflozin"], "expected_action_verbs": ["prescribe"], "expected_has_image": false },
      { "id": "IA-06", "input": "Save a note about the patient's amoxicillin allergy", "expected_patient_ids": [], "expected_drug_mentions": ["amoxicillin"], "expected_action_verbs": ["save"], "expected_has_image": false }
    ],

    "synthesis_regression_tests": [
      { "id": "SY-01", "scenario": "Drug safety result with tool name leakage check", "tool_results": [{ "tool_label": "Drug Safety Report", "data": "Dofetilide boxed warning: Torsade de Pointes risk" }], "forbidden_strings": ["check_drug_safety", "tool_name", "tool_call", "[check_drug_safety]"], "notes": "Synthesis must NOT include internal tool names. §50 recommendation #5." },
      { "id": "SY-02", "scenario": "Error result — must not hallucinate", "tool_results": [{ "tool_label": "Drug Safety Report", "error": "XYZ-4829 was not found in the drug database." }], "forbidden_strings": ["boxed warning", "FDA warning", "contraindicated"], "notes": "When tool fails, synthesis must NOT fabricate safety data from pretrained knowledge. §48: raw errors → 4.8/10." },
      { "id": "SY-03", "scenario": "Empty output regression", "tool_results": [], "task_summary": "User asking about hypertension", "verify": "response_length > 0", "notes": "Verify synthesis NEVER produces empty output. §42: 13% empty rate with thinking prefixes — we don't use them, but verify." },
      { "id": "SY-04", "scenario": "Brevity check", "tool_results": [{ "tool_label": "Drug Safety Report", "data": "Metformin lactic acidosis warning" }], "verify": "response_tokens <= 256", "notes": "max_tokens=256. Verify output stays concise. §50: quality improves at 256 vs 512." }
    ]
  }
}
